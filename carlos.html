<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>最終ダメージ計算式（ホワイトアウトサバイバル）</title>
<style>
  :root{
    --bg:#0b0f14;
    --panel:#111827;
    --panel-2:#0f172a;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --accent:#60a5fa;
    --green:#34d399;
    --blue:#60a5fa;
    --yellow:#fbbf24;
    --red:#f87171;
    --border:#1f2937;
    --code:#0b1220;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
    background: #0b0f14;
    color:var(--text);
    line-height:1.7;
    letter-spacing: .02em;
  }
  .container{
    max-width: 980px;
    margin: 48px auto 96px;
    padding: 0 20px;
  }
  header{
    display:flex;align-items:center;gap:16px;flex-wrap:wrap;
    margin-bottom: 28px;
  }
  .badge{
    padding:6px 10px;border-radius:999px;
    background:linear-gradient(135deg,var(--panel),var(--panel-2));
    border:1px solid var(--border);color:var(--muted);font-size:12px
  }
  h1{
    font-size: clamp(28px, 4vw, 40px);
    line-height:1.2;margin:6px 0 8px;
    letter-spacing:.01em;
  }
  .sub{
    color:var(--muted);font-size:14px;margin-bottom:8px
  }
  .grid{
    display:grid;gap:16px;
  }
  @media(min-width:900px){
    .grid-2{grid-template-columns:1.15fr .85fr}
  }
  section.card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid var(--border);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  section.card h2{
    font-size: clamp(20px, 2.5vw, 24px);
    margin: 4px 0 12px;
    display:flex; align-items:center; gap:10px;
  }
  .tag{
    padding:2px 8px;border-radius:8px;font-size:12px;border:1px solid var(--border);color:var(--muted)
  }
  .kicker{color:var(--muted);font-size:13px;margin-top:-2px;margin-bottom:10px}
  .list{margin:10px 0 0 0;padding-left:1.2em}
  .list li{margin:.25em 0}
  .muted{color:var(--muted)}
  .chiprow{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 2px}
  .chip{font-size:12px;padding:2px 8px;border:1px solid var(--border);border-radius:999px;color:var(--muted);background:#0c1320}
  hr.sep{border:none;height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:18px 0}
  pre{
    background: linear-gradient(180deg, #0b1220, #0c111b);
    border:1px solid #0e1a2f;
    color:#dbeafe;
    border-radius:12px;
    padding:14px 16px; overflow:auto; margin: 10px 0 0;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Noto Sans Mono", monospace;
    font-size: 13.5px; line-height:1.7;
  }
  .pill{
    display:inline-flex;align-items:center;gap:8px;
    padding:8px 10px;border-radius:12px;
    border:1px solid var(--border); background:linear-gradient(180deg,#0f1625,#0c1320);
    margin:4px 6px 0 0; font-size:13px; color:var(--muted)
  }
  .c-green{color:var(--green)} .c-blue{color:var(--blue)} .c-yellow{color:var(--yellow)} .c-red{color:var(--red)}
  .accent{color:var(--accent)}
  .callout{
    margin-top:8px;
    background:linear-gradient(180deg,rgba(96,165,250,.08),rgba(96,165,250,.04));
    border:1px solid rgba(96,165,250,.25);
    color:#dbeafe;
    padding:10px 12px;border-radius:12px;font-size:13.5px
  }
  footer{color:var(--muted);font-size:12.5px;margin-top:28px}
</style>
</head>
<body>
  <div class="container">

    <header>
      <h1>最終ダメージ計算式</h1>
    </header>

    <!-- 最終ダメージ計算式 -->
    <section class="card">
      <h2>⚔ 最終ダメージ計算式</h2>
      <pre>最終ダメージ ＝    
        🟩 基礎係数 × 
        (
          ( 
            🟦 攻撃力 × ( 1 + 攻撃力上昇 − 攻撃力低下 ) × 
            🟦 殺傷力 × ( 1 + 殺傷力上昇 − 殺傷力低下 ) 
          )
          ÷
          ( 
            🟦 防御力 × ( 1 + 防御力上昇 − 防御力低下 ) × 
            🟦 HP × ( 1 + HP上昇 − HP低下)
          )
        ) ×
        ( 1 + 与ダメ上昇 ) × ∏( 1 − 与ダメ減少n ) ×
        ( 1 + 被ダメ上昇 ) × ∏( 1 − 被ダメ減少m ) ×
        ( 1 + 🟨 クリティカル補正 ) ×
        🟥 特殊補正</pre>
    <div class="kicker">
      「∏(1 − 与ダメ減少n)」「∏(1 − 被ダメ減少m)」は、<br/>
      同系統が複数ある場合に全部掛け合わせるという意味（乗算スタック）。<br/>
      被ダメ減少20％が2つの場合、(1 − 0.2) × (1 − 0.2)と計算する。
    </div>
    </section>


    <!-- 処理のイメージ -->
    <section class="card">
      <h2>● 処理のイメージ</h2>
      <ul class="list">
        <li>攻撃側ダメージ = 攻撃側の最終ダメージ計算</li>
        <li>防衛側ダメージ = 防衛側（駐屯）の最終ダメージ計算</li>
      </ul>
      <pre>攻撃側残HP = 攻撃側HP − 防衛側ダメージ  
防衛側残HP = 防衛側HP − 攻撃側ダメージ</pre>
      <div class="callout">
        <strong>判定の考え方：</strong><br/>
        ・残HPが 0 以下になった方 → 撃破（全滅または撤退）<br/>
        ・残HPが 残っている方 → 勝利（防衛成功 or 攻撃成功）<br/>
        ・両者が生き残る → 戦闘が続行（次ターンへ）<br/>
        ・HP上昇、HP低下はここの計算で使用される
      </div>
    </section>

    <div class="grid grid-2">

      <!-- 基礎係数 -->
      <section class="card">
        <h2><span class="c-green">🟩</span> 基礎係数（Base Multiplier）</h2>
        <div class="kicker">戦闘の「土台」となる定数で、<br/>兵種・戦闘タイプ・環境条件などによって内部的に設定された倍率。<br/>攻撃側と防衛側の両方に影響し、すべての計算の最初に掛けられる。</div>
        <hr class="sep" />
        <div class="tag">【概要】</div>
        <ul class="list">
          <li>盾・槍・弓など兵種ごとの基本相性を反映</li>
          <li>攻撃側／防衛側など戦闘種別ごとに異なる内部倍率を持つ</li>
          <li>一部の環境効果（領主装備、島バフなど）もこの層で処理される</li>
        </ul>

        <hr class="sep" />
        <div class="tag">【具体例】</div>

        <p><strong>1️⃣ 兵種相性係数</strong><br/>→ 各兵種の強弱関係による基本補正</p>

        <div class="pill">【相性倍率マトリクス】</div>
        <pre>　└ 攻撃→防御 = 相性係数  
　└ 盾 → 槍 = 1.05倍（有利）  
　└ 盾 → 弓 = 0.95倍（不利）  
　└ 槍 → 弓 = 1.05倍（有利）  
　└ 槍 → 盾 = 0.95倍（不利）  
　└ 弓 → 盾 = 1.05倍（有利）  
　└ 弓 → 槍 = 0.95倍（不利）  
　└ 同種（盾→盾、槍→槍、弓→弓） = 1.00倍（等倍）</pre>

        <div class="pill">【兵種相性係数の計算式】</div>
        <pre>兵種相性係数 ＝
( A₁ × ( D₁×1.00 + D₂×1.05 + D₃×0.95 ) ) ＋
( A₂ × ( D₁×0.95 + D₂×1.00 + D₃×1.05 ) ) ＋
( A₃ × ( D₁×1.05 + D₂×0.95 + D₃×1.00 ) )</pre>

        <div class="pill">【例】</div>
        <pre>攻撃側：盾0.5、槍0.3、弓0.2  
防御側：盾0.2、槍0.5、弓0.3  

兵種相性係数 ＝
(0.5 × (0.2×1.00 + 0.5×1.05 + 0.3×0.95)) +
(0.3 × (0.2×0.95 + 0.5×1.00 + 0.3×1.05)) +
(0.2 × (0.2×1.05 + 0.5×0.95 + 0.3×1.00))
＝ 約1.0035</pre>

        <hr class="sep" />
        <p><strong>2️⃣ 領主装備セット効果</strong><br/>　→ 装備品質やセット効果による恒常的な戦闘倍率</p>
        <p><strong>3️⃣ 島バフ</strong><br/>　→ 島の所有で加算</p>

        <div class="callout">
          📘 <strong>補足：</strong><br/>
          この係数は全ダメージ計算の基準であり、<br/>
          他のバフ（攻撃力・与ダメなど）の前段階で適用される。<br/>
          計算の土台のため戦闘全体の倍率が大きく変化する傾向がある。
        </div>
      </section>

      <!-- 攻撃力/防御力 -->
      <section class="card">
        <h2><span class="c-blue">🟦</span> 攻撃力（Attack Power）/ 防御力（Defense Power）</h2>
        <div class="kicker">研究・装備・専門家・英雄などによって上昇する恒常的な戦闘力の基礎値。<br/>プレイヤーが強化を積み上げていく「本体ステータス層」であり、<br/>全戦闘において常時有効。全ての計算の土台になる。</div>
        <hr class="sep" />
        <div class="tag">該当要素：</div>
        <ul class="list">
          <li>専門家スキル（通常効果）<br/>　└ 攻撃力・防御力・HP上昇など恒常的な強化。常時発動。</li>
          <li>研究（戦闘関連）<br/>　└ 部隊能力を恒常的に上昇。全戦闘に適用される。</li>
          <li>ペットバフ（常時効果）<br/>　└ 攻撃・防御・HPアップなど。戦闘全般で常時有効。</li>
          <li>ペットスキル<br/>　└ 条件なしで発動するパッシブ効果。攻撃・防御・HP上昇を直接反映。</li>
          <li>火晶英雄スキル<br/>　└ 攻撃／防御／HP上昇が中心。条件発動ではなく恒常型。</li>
          <li>兵士ステータス<br/>　└ 各兵種（歩兵・射手・騎兵など）の基礎攻撃・防御・HP値。<br/>　　 兵ランク（Tランク）に応じて上昇し、最下層で攻撃力を構成。</li>
          <li>英雄ステータス<br/>　└ 英雄レベル・昇格・ランクアップで上昇する攻撃・防御・HPの基礎値。</li>
          <li>アイテムバフ<br/>　└ 攻撃力アップ・行軍強化アイテムなど、一時的だが攻撃力層に含まれる。</li>
          <li>宝石（装着効果）<br/>　└ HP・殺傷力のステータス上昇を付与。</li>
          <li>英雄装備<br/>　└ 英雄能力を恒常強化し、戦闘ステータスに直接反映。</li>
          <li>英雄スキル（恒常効果）<br/>　└ 攻撃力・与ダメージ上昇など、常に発動しているタイプ。</li>
          <li>英雄専用装備<br/>　└ 専用装備による恒常ステータス強化。</li>
        </ul>
      </section>

    </div>

    <!-- クリティカル補正 -->
    <section class="card">
      <h2><span class="c-yellow">🟨</span> クリティカル補正（Critical Modifier）</h2>
      <div class="kicker">戦闘時に内部乱数によって発生する微小なダメージ変動を平均化した理論補正値。<br/>ホワサバではクリティカル率やクリティカルダメージといった<br/>明示的なステータスは存在せず、<br/>“攻撃ごとに数％のランダム誤差”が発生するのみ。</div>
      <hr class="sep" />
      <div class="tag">概要：</div>
      <ul class="list">
        <li>クリティカル率／クリティカルダメージを上げる手段は未実装</li>
        <li>実際の戦闘では各攻撃ごとに±数％のランダム幅が発生</li>
        <li>このブレを理論上「クリティカル補正」として整理</li>
        <li>平均値（多数回の戦闘）では <strong>1.00倍</strong> として収束</li>
      </ul>
      <div class="pill">理論モデル：</div>
      <pre>補正式：
1 + (発生率 × (倍率 − 1))

例：
発生率5%、倍率150%の場合
→ 補正＝1＋(0.05×0.5)=1.025（＝＋2.5%）

※ホワサバでは実際の発生率・倍率ともに固定化されておらず、
　平均的には (1＋クリティカル補正) = 1.00 として扱う。</pre>
    </section>

    <!-- 特殊補正 -->
    <section class="card">
      <h2><span class="c-red">🟥</span> 特殊補正（Special Multiplier）</h2>
      <div class="kicker">通常のバフ計算には含まれず、<br/>特定条件下でのみ発動する特別な乗算補正。<br/>イベントや特殊スキル発動時に最終ダメージへ直接乗算される。</div>
      <hr class="sep" />
      <div class="tag">概要：</div>
      <ul class="list">
        <li>通常の戦闘では発動しない</li>
        <li>特定の条件下でのみ有効</li>
        <li>発動時は最終ダメージに乗算される</li>
      </ul>
      <hr class="sep" />
      <div class="tag">該当要素：</div>
      <ul class="list">
        <li>専門家「シリル」スキル<br/>　└ 熊罠発動時のみ有効（ダメージ＋30%）。条件付き限定効果。</li>
        <li>イベント「燃霜（氷炎鉱山）」スキル<br/>　└ イベント専用スキル・行軍／戦闘バフ。イベント中のみ発動。</li>
        <li>ターン制／確率発動型の英雄スキル<br/>　└ 発動時のみ有効な追加ダメージ倍率や一時的デバフ効果。<br/>　　 攻撃力層には含まれず、スキル発動時にのみ特殊補正として乗算される。</li>
      </ul>

      <hr class="sep" />
      <div class="tag">補足：ターン制／確率発動型スキルについて</div>
      <div class="kicker">
        ホワサバの戦闘はターン制で進行し、英雄の一部スキルは確率で発動する。<br/>
        これらのスキルは「恒常バフ」ではなく、発動したターンにのみ有効。
      </div>
      <ul class="list">
        <li>効果内容が「追加ダメージ倍率」の場合 → <strong>特殊補正</strong> として最終ダメージに乗算</li>
        <li>効果内容が「防御力低下」や「被ダメ上昇」など既存パラメータに一致する場合 →<br/>　そのターンのみ該当パラメータに一時加算</li>
      </ul>
      <pre>例：
- フリント → 確率で追加ダメージ → 特殊補正
- ミア → 確率で被ダメ上昇 → 被ダメ上昇パラメータに一時加算</pre>
    </section>

  </div>
</body>
</html>
